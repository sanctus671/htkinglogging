(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{y5vB:function(n,e,t){"use strict";t.r(e);var o=t("CcnG"),l=function(){return function(){}}(),r=t("pMnS"),i=t("oBZk"),u=t("ZZ/e"),a=t("ZYCi"),s=t("Ip0R"),c=t("lXZ+"),d=t("gIcY"),f=t("fLD/"),m=t("ri4K"),g=t("KOTj"),p=t("QaJk"),_=t("0UgC"),h=t("wd/R"),v=function(){function n(n,e,t,o,l,r,i,u,a,s){var c=this;this.formService=n,this.toastController=e,this.modalController=t,this.router=o,this.authenticationService=l,this.alertCtrl=r,this.ngZone=i,this.offlineService=u,this.submissionService=a,this.messageService=s,this.loading=!0,this.search="",this.filters={orderby:"created_at",order:"asc",city:"",suburb:""},this.forms=[],this.formGroups=[],this.formattedForms={},this.user={},this.authenticationService.getUserData().subscribe((function(n){c.ngZone.run((function(){c.user=n}))})),this.offlineService.monitorUploads().subscribe((function(n){n&&n.uploaded&&c.getForms()})),this.messageService.getMessageReceived().subscribe((function(n){c.ngZone.run((function(){n&&(n.unread||0===n.unread)&&(c.unreadMessages=n.unread)}))})),this.messageService.getMessages().then((function(){})).catch((function(n){}))}return n.prototype.ionViewDidEnter=function(){this.getForms()},n.prototype.getForms=function(){var n=this;this.loading=!0,this.offlineService.getFormGroups().then((function(e){e?n.setFormGroupData(e):n.getOnlineForms()})).catch((function(){n.getOnlineForms()}))},n.prototype.getOnlineForms=function(){var n=this;this.formService.getFormGroups().then((function(e){n.offlineService.saveFormGroups(e),n.setFormGroupData(e)})).catch((function(){n.offlineService.getFormGroups().then((function(e){e&&n.setFormGroupData(e)}))}))},n.prototype.setFormGroupData=function(n){var e=this;this.formGroups=n,this.formattedForms={},this.formGroups.push({name:"Other"});for(var t=0,o=this.formGroups;t<o.length;t++)this.formattedForms[o[t].name]=[];this.offlineService.getForms().then((function(n){n?(e.setFormData(n),e.loading=!1):e.getOnlineFormGroupData()})).catch((function(){e.getOnlineFormGroupData()}))},n.prototype.getOnlineFormGroupData=function(){var n=this;this.formService.getForms(this.search,this.filters).then((function(e){n.offlineService.saveForms(e.data),n.formattedForms={};for(var t=0,o=n.formGroups;t<o.length;t++)n.formattedForms[o[t].name]=[];n.setFormData(e.data),n.loading=!1})).catch((function(){n.loading=!1}))},n.prototype.setFormData=function(n){this.forms=n;for(var e=0,t=this.forms;e<t.length;e++){var o=t[e];o.form_group?this.formattedForms[o.form_group.name].push(o):this.formattedForms.Other.push(o)}this.setFormCompletionDates()},n.prototype.setFormCompletionDates=function(){var n=this;this.formGroups.unshift({id:0,name:"DUE SOON"}),this.formGroups.unshift({id:0,name:"OVERDUE"}),this.formattedForms.OVERDUE=[],this.formattedForms["DUE SOON"]=[];for(var e=function(e){if(e.completion_date){var o=h(e.completion_date),l=h(),r=h().add(7,"days"),i=7;if(e.completion_date_duration)if("daily"===e.completion_date_duration)o=h(),r=h().add(1,"days"),i=1;else if("weekly"===e.completion_date_duration){var u=o.day();(o=h()).set("day",u),i=7}else if("fornightly"===e.completion_date_duration)u=o.day(),(o=h()).set("day",u).add(7,"days"),i=14;else if("monthly"===e.completion_date_duration){var a=o.date();(o=h()).set("date",a),i=31}else if("quarterly"===e.completion_date_duration)a=o.date(),(o=h()).set("date",a),o.set("day",a).add(3,"months"),i=93;else if("halfyearly"===e.completion_date_duration)a=o.date(),(o=h()).set("date",a),o.set("day",a).add(6,"months"),i=186;else if("yearly"===e.completion_date_duration){a=o.date();var s=o.month();(o=h()).set("date",a),o.set("month",s),i=365}t.offlineService.getLastSubmitted(e.id).then((function(t){var u=h().subtract("1","years");t&&(u=h(t));var a=h(o);a.subtract(i,"days"),(t&&(!e.completion_date_duration||"none"===e.completion_date_duration)||u.isAfter(a))&&(e.submitted=!0,e.submitted_at=t),l.isAfter(o)&&!e.submitted?(e.overdue=!0,n.formattedForms.OVERDUE.push(e)):r.isAfter(o)&&!e.submitted&&(e.due=!0,n.formattedForms["DUE SOON"].push(e)),(e.overdue||e.due)&&n.checkOnlineLastSubmitted(e,h(a))})).catch((function(){}))}},t=this,o=0,l=this.forms;o<l.length;o++)e(l[o])},n.prototype.checkOnlineLastSubmitted=function(n,e){var t=this;this.submissionService.getLastSubmitted(n.id).then((function(o){if(o&&o.created_at){var l=h(o.overdue_submission_date?o.overdue_submission_date:o.created_at);if(h(o.overdue_submission_date),!n.completion_date_duration||"none"===n.completion_date_duration||l.isAfter(e)){for(var r in n.overdue=!1,n.due=!1,t.formattedForms.OVERDUE)if(t.formattedForms.OVERDUE[r].id===n.id){t.formattedForms.OVERDUE.splice(r,1);break}for(var r in t.formattedForms["DUE SOON"])if(t.formattedForms["DUE SOON"][r].id===n.id){t.formattedForms["DUE SOON"].splice(r,1);break}}}})).catch((function(){}))},n.prototype.getSubmissions=function(){var n=this;return new Promise((function(e,t){var o=[];n.offlineService.getSubmissions().then((function(n){n&&o.concat(n)})),n.submissionService.getSubmissions(n.search).then((function(n){o.concat(n.data),e(o)})).catch((function(){n.offlineService.getOnlineSubmissions().then((function(n){n&&n.data&&o.concat(n.data),e(o)})).catch((function(){e(o)}))}))}))},n.prototype.doSearch=function(){},n.prototype.formatDate=function(n){var e=-(new Date).getTimezoneOffset();return h(n).add(e,"m").fromNow()},n}(),C=o["\u0275crt"]({encapsulation:0,styles:[["ion-toolbar[_ngcontent-%COMP%]   .notification-icon-button[_ngcontent-%COMP%]{--overflow:visible}ion-toolbar[_ngcontent-%COMP%]   .notification-icon-button[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{position:absolute;background:#f70b0b;border-radius:50%;opacity:.9;top:.1rem;right:.2rem}.forms.ios[_ngcontent-%COMP%]   .forms__search[_ngcontent-%COMP%]   .forms__search__filter[_ngcontent-%COMP%]{top:12px}.forms[_ngcontent-%COMP%]   .forms__search[_ngcontent-%COMP%]{position:relative;margin-top:10px}.forms[_ngcontent-%COMP%]   .forms__search[_ngcontent-%COMP%]   .forms__search__filter[_ngcontent-%COMP%]{position:absolute;top:7px;right:10px;font-size:10px}.forms[_ngcontent-%COMP%]   .forms__list[_ngcontent-%COMP%]{margin-top:15px}.forms[_ngcontent-%COMP%]   .forms__list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]{font-weight:600}.forms[_ngcontent-%COMP%]   .forms__list[_ngcontent-%COMP%]   .forms__list__form--due[_ngcontent-%COMP%]{--background:#eba31c}.forms[_ngcontent-%COMP%]   .forms__list[_ngcontent-%COMP%]   .forms__list__form--due[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fff}.forms[_ngcontent-%COMP%]   .forms__list[_ngcontent-%COMP%]   .forms__list__form--due[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:rgba(255,255,255,.7)}.forms[_ngcontent-%COMP%]   .forms__list[_ngcontent-%COMP%]   .forms__list__form--overdue[_ngcontent-%COMP%]{--background:#eb1c24}.forms[_ngcontent-%COMP%]   .forms__list[_ngcontent-%COMP%]   .forms__list__form--overdue[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fff}.forms[_ngcontent-%COMP%]   .forms__list[_ngcontent-%COMP%]   .forms__list__form--overdue[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:rgba(255,255,255,.7)}.forms[_ngcontent-%COMP%]   .forms__loading[_ngcontent-%COMP%]{text-align:center;margin-top:60px}"]],data:{}});function b(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,2,"ion-badge",[["color","danger"]],null,null,null,i.I,i.d)),o["\u0275did"](1,49152,null,0,u.j,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],{color:[0,"color"]},null),(n()(),o["\u0275ted"](2,0,["",""]))],(function(n,e){n(e,1,0,"danger")}),(function(n,e){n(e,2,0,e.component.unreadMessages)}))}function O(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,2,"div",[["class","forms__loading"]],null,null,null,null,null)),(n()(),o["\u0275eld"](1,0,null,null,1,"ion-spinner",[["color","primary"]],null,null,null,i.db,i.y)),o["\u0275did"](2,49152,null,0,u.sb,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],{color:[0,"color"]},null)],(function(n,e){n(e,2,0,"primary")}),null)}function R(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,14,"ion-item",[["class","forms__list__form"],["detail",""],["routerDirection","forward"]],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==o["\u0275nov"](n,2).onClick()&&l),"click"===e&&(l=!1!==o["\u0275nov"](n,5).onClick(t)&&l),l}),i.S,i.n)),o["\u0275did"](1,49152,null,0,u.H,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],{detail:[0,"detail"],routerDirection:[1,"routerDirection"]},null),o["\u0275did"](2,16384,null,0,a.n,[a.m,a.a,[8,null],o.Renderer2,o.ElementRef],{queryParams:[0,"queryParams"],routerLink:[1,"routerLink"]},null),o["\u0275pod"](3,{overdue:0,due:1}),o["\u0275pad"](4,1),o["\u0275did"](5,737280,null,0,u.Ob,[s.g,u.Ib,o.ElementRef,a.m,[2,a.n]],{routerDirection:[0,"routerDirection"]},null),o["\u0275prd"](512,null,s.r,s.s,[o.IterableDiffers,o.KeyValueDiffers,o.ElementRef,o.Renderer2]),o["\u0275did"](7,278528,null,0,s.h,[s.r],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),o["\u0275pod"](8,{"forms__list__form--overdue":0,"forms__list__form--due":1}),(n()(),o["\u0275eld"](9,0,null,0,5,"ion-label",[],null,null,null,i.T,i.o)),o["\u0275did"](10,49152,null,0,u.N,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],null,null),(n()(),o["\u0275eld"](11,0,null,0,1,"h2",[],null,null,null,null,null)),(n()(),o["\u0275ted"](12,null,["",""])),(n()(),o["\u0275eld"](13,0,null,0,1,"p",[],null,null,null,null,null)),(n()(),o["\u0275ted"](-1,null,["Tap to start this form"]))],(function(n,e){n(e,1,0,"","forward");var t=n(e,3,0,e.context.$implicit.overdue,e.context.$implicit.due),o=n(e,4,0,"/form/"+e.context.$implicit.id);n(e,2,0,t,o),n(e,5,0,"forward");var l=n(e,8,0,e.context.$implicit.overdue,e.context.$implicit.due);n(e,7,0,"forms__list__form",l)}),(function(n,e){n(e,12,0,e.context.$implicit.name)}))}function D(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,7,"ion-list",[["class","forms__list"]],null,null,null,i.V,i.p)),o["\u0275did"](1,49152,null,0,u.O,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],null,null),(n()(),o["\u0275eld"](2,0,null,0,2,"ion-list-header",[],null,null,null,i.U,i.q)),o["\u0275did"](3,49152,null,0,u.P,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],null,null),(n()(),o["\u0275ted"](4,0,[" "," "])),(n()(),o["\u0275and"](16777216,null,0,2,null,R)),o["\u0275did"](6,278528,null,0,s.i,[o.ViewContainerRef,o.TemplateRef,o.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),o["\u0275ppd"](7,2)],(function(n,e){var t=e.component,l=o["\u0275unv"](e,6,0,n(e,7,0,o["\u0275nov"](e.parent.parent.parent,0),t.formattedForms[e.parent.context.$implicit.name],t.search));n(e,6,0,l)}),(function(n,e){n(e,4,0,e.parent.context.$implicit.name)}))}function M(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),o["\u0275and"](16777216,null,null,1,null,D)),o["\u0275did"](2,16384,null,0,s.j,[o.ViewContainerRef,o.TemplateRef],{ngIf:[0,"ngIf"]},null)],(function(n,e){var t=e.component;n(e,2,0,t.formattedForms[e.context.$implicit.name]&&t.formattedForms[e.context.$implicit.name].length>0)}),null)}function F(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),o["\u0275and"](16777216,null,null,1,null,M)),o["\u0275did"](2,278528,null,0,s.i,[o.ViewContainerRef,o.TemplateRef,o.IterableDiffers],{ngForOf:[0,"ngForOf"]},null)],(function(n,e){n(e,2,0,e.component.formGroups)}),null)}function y(n){return o["\u0275vid"](0,[o["\u0275pid"](0,c.a,[]),(n()(),o["\u0275eld"](1,0,null,null,24,"ion-header",[],null,null,null,i.P,i.k)),o["\u0275did"](2,49152,null,0,u.B,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],null,null),(n()(),o["\u0275eld"](3,0,null,0,22,"ion-toolbar",[["color","primary"]],null,null,null,i.jb,i.E)),o["\u0275did"](4,49152,null,0,u.Cb,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],{color:[0,"color"]},null),(n()(),o["\u0275eld"](5,0,null,0,2,"ion-title",[],null,null,null,i.ib,i.D)),o["\u0275did"](6,49152,null,0,u.Ab,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],null,null),(n()(),o["\u0275ted"](-1,0,[" Forms "])),(n()(),o["\u0275eld"](8,0,null,0,17,"ion-buttons",[["slot","end"]],null,null,null,i.K,i.f)),o["\u0275did"](9,49152,null,0,u.l,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],null,null),(n()(),o["\u0275eld"](10,0,null,0,8,"ion-button",[["class","notification-icon-button"],["routerDirection","forward"]],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==o["\u0275nov"](n,12).onClick()&&l),"click"===e&&(l=!1!==o["\u0275nov"](n,14).onClick(t)&&l),l}),i.J,i.e)),o["\u0275did"](11,49152,null,0,u.k,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],{routerDirection:[0,"routerDirection"]},null),o["\u0275did"](12,16384,null,0,a.n,[a.m,a.a,[8,null],o.Renderer2,o.ElementRef],{routerLink:[0,"routerLink"]},null),o["\u0275pad"](13,1),o["\u0275did"](14,737280,null,0,u.Ob,[s.g,u.Ib,o.ElementRef,a.m,[2,a.n]],{routerDirection:[0,"routerDirection"]},null),(n()(),o["\u0275and"](16777216,null,0,1,null,b)),o["\u0275did"](16,16384,null,0,s.j,[o.ViewContainerRef,o.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),o["\u0275eld"](17,0,null,0,1,"ion-icon",[["name","notifications"],["slot","icon-only"]],null,null,null,i.Q,i.l)),o["\u0275did"](18,49152,null,0,u.C,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],{name:[0,"name"]},null),(n()(),o["\u0275eld"](19,0,null,0,6,"ion-button",[["routerDirection","forward"]],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==o["\u0275nov"](n,21).onClick()&&l),"click"===e&&(l=!1!==o["\u0275nov"](n,23).onClick(t)&&l),l}),i.J,i.e)),o["\u0275did"](20,49152,null,0,u.k,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],{routerDirection:[0,"routerDirection"]},null),o["\u0275did"](21,16384,null,0,a.n,[a.m,a.a,[8,null],o.Renderer2,o.ElementRef],{routerLink:[0,"routerLink"]},null),o["\u0275pad"](22,1),o["\u0275did"](23,737280,null,0,u.Ob,[s.g,u.Ib,o.ElementRef,a.m,[2,a.n]],{routerDirection:[0,"routerDirection"]},null),(n()(),o["\u0275eld"](24,0,null,0,1,"ion-icon",[["name","settings"],["slot","icon-only"]],null,null,null,i.Q,i.l)),o["\u0275did"](25,49152,null,0,u.C,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],{name:[0,"name"]},null),(n()(),o["\u0275eld"](26,0,null,null,13,"ion-content",[["class","forms"]],null,null,null,i.M,i.h)),o["\u0275did"](27,49152,null,0,u.u,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],null,null),(n()(),o["\u0275eld"](28,0,null,0,7,"div",[["class","forms__search"]],null,null,null,null,null)),(n()(),o["\u0275eld"](29,0,null,null,6,"ion-searchbar",[["color","light"],["placeholder","Find a form..."]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"ionChange"],[null,"ionBlur"]],(function(n,e,t){var l=!0,r=n.component;return"ionBlur"===e&&(l=!1!==o["\u0275nov"](n,31)._handleBlurEvent(t.target)&&l),"ionChange"===e&&(l=!1!==o["\u0275nov"](n,31)._handleInputEvent(t.target)&&l),"ngModelChange"===e&&(l=!1!==(r.search=t)&&l),"ionChange"===e&&(l=!1!==r.doSearch()&&l),l}),i.Y,i.t)),o["\u0275did"](30,49152,null,0,u.kb,[o.ChangeDetectorRef,o.ElementRef,o.NgZone],{color:[0,"color"],placeholder:[1,"placeholder"]},null),o["\u0275did"](31,16384,null,0,u.Qb,[o.ElementRef],null,null),o["\u0275prd"](1024,null,d.c,(function(n){return[n]}),[u.Qb]),o["\u0275did"](33,671744,null,0,d.h,[[8,null],[8,null],[8,null],[6,d.c]],{model:[0,"model"]},{update:"ngModelChange"}),o["\u0275prd"](2048,null,d.d,null,[d.h]),o["\u0275did"](35,16384,null,0,d.e,[[4,d.d]],null,null),(n()(),o["\u0275and"](16777216,null,0,1,null,O)),o["\u0275did"](37,16384,null,0,s.j,[o.ViewContainerRef,o.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),o["\u0275and"](16777216,null,0,1,null,F)),o["\u0275did"](39,16384,null,0,s.j,[o.ViewContainerRef,o.TemplateRef],{ngIf:[0,"ngIf"]},null)],(function(n,e){var t=e.component;n(e,4,0,"primary"),n(e,11,0,"forward");var o=n(e,13,0,"/messages");n(e,12,0,o),n(e,14,0,"forward"),n(e,16,0,t.unreadMessages>0),n(e,18,0,"notifications"),n(e,20,0,"forward");var l=n(e,22,0,"/settings");n(e,21,0,l),n(e,23,0,"forward"),n(e,25,0,"settings"),n(e,30,0,"light","Find a form..."),n(e,33,0,t.search),n(e,37,0,t.loading),n(e,39,0,!t.loading)}),(function(n,e){n(e,29,0,o["\u0275nov"](e,35).ngClassUntouched,o["\u0275nov"](e,35).ngClassTouched,o["\u0275nov"](e,35).ngClassPristine,o["\u0275nov"](e,35).ngClassDirty,o["\u0275nov"](e,35).ngClassValid,o["\u0275nov"](e,35).ngClassInvalid,o["\u0275nov"](e,35).ngClassPending)}))}function P(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,1,"app-forms",[],null,null,null,y,C)),o["\u0275did"](1,49152,null,0,v,[f.a,u.Rb,u.Hb,a.m,m.a,u.a,o.NgZone,g.a,p.a,_.a],null,null)],null,null)}var E=o["\u0275ccf"]("app-forms",v,P,{},{},[]),k=t("iTUp");t.d(e,"FormsPageModuleNgFactory",(function(){return S}));var S=o["\u0275cmf"](l,[],(function(n){return o["\u0275mod"]([o["\u0275mpd"](512,o.ComponentFactoryResolver,o["\u0275CodegenComponentFactoryResolver"],[[8,[r.a,E]],[3,o.ComponentFactoryResolver],o.NgModuleRef]),o["\u0275mpd"](4608,s.l,s.k,[o.LOCALE_ID,[2,s.w]]),o["\u0275mpd"](4608,u.b,u.b,[o.NgZone,o.ApplicationRef]),o["\u0275mpd"](4608,u.Hb,u.Hb,[u.b,o.ComponentFactoryResolver,o.Injector]),o["\u0275mpd"](4608,u.Mb,u.Mb,[u.b,o.ComponentFactoryResolver,o.Injector]),o["\u0275mpd"](4608,d.j,d.j,[]),o["\u0275mpd"](1073742336,s.b,s.b,[]),o["\u0275mpd"](1073742336,u.Eb,u.Eb,[]),o["\u0275mpd"](1073742336,d.i,d.i,[]),o["\u0275mpd"](1073742336,d.b,d.b,[]),o["\u0275mpd"](1073742336,a.p,a.p,[[2,a.u],[2,a.m]]),o["\u0275mpd"](1073742336,k.a,k.a,[]),o["\u0275mpd"](1073742336,l,l,[]),o["\u0275mpd"](1024,a.k,(function(){return[[{path:"",component:v}]]}),[])])}))}}]);