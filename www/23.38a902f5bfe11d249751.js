(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{zDS7:function(n,e,t){"use strict";t.r(e);var l=t("CcnG"),o=t("ZZ/e"),i=t("ri4K"),s=t("9B/o"),c=t("c7H9"),u=t("KOTj"),r=t("QaJk"),a=t("fLD/"),d=t("IwxM"),f=t("wd/R"),m=function(){function n(n,e,t,l,o,i,s,c,u,r){var a=this;this.plt=n,this.profileService=e,this.authenticationService=t,this.alertCtrl=l,this.iab=o,this.offlineService=i,this.submissionService=s,this.loadingController=c,this.formService=u,this.documentService=r,this.user={},this.authenticationService.getUserData().subscribe((function(n){a.user=n})),this.paymentTotal=0,this.documentsLastSynced="",this.offlineService.getDocumentsLastSyncedAt().then((function(n){a.documentsLastSynced=n}))}return n.prototype.ngOnInit=function(){},n.prototype.ionViewDidEnter=function(){},n.prototype.clearLastSynced=function(n){var e=this;n.preventDefault(),n.stopPropagation(),this.offlineService.saveDocumentsLastSyncedAt(null).then((function(){e.documentsLastSynced=""}))},n.prototype.syncForms=function(){var n=this;this.loadingController.create({message:"Forms are being synced. Please wait..."}).then((function(e){n.loading=e,e.present(),n.getForms()}))},n.prototype.syncDocuments=function(){var n=this;this.loadingController.create({message:"Documents are being synced. Please wait..."}).then((function(e){n.loading=e,e.present(),n.getDocuments()}))},n.prototype.getDocuments=function(){var n=this;this.documentService.getDocumentGroups().then((function(e){n.offlineService.saveDocumentGroups(e),n.documentService.getDocuments("",{orderby:"created_at",order:"asc",city:"",suburb:""}).then((function(e){n.offlineService.saveDocuments(e.data);var t=e.data;n.offlineService.getDocumentsLastSyncedAt().then((function(e){n.documentsLastSynced=e,n.downloadDocument(t,0)})).catch((function(){n.downloadDocument(t,0)}))})).catch((function(){n.showError("documents")}))})).catch((function(){n.showError("documents")}))},n.prototype.downloadDocument=function(n,e){var t=this;if(e===n.length){this.showSuccess("documents"),this.offlineService.submissionsUploaded();var l=-(new Date).getTimezoneOffset(),o=f().add(-l,"m").format("YYYY-MM-DD");return this.documentsLastSynced=o,void this.offlineService.saveDocumentsLastSyncedAt(o)}var i=n[e];this.loading.message="Downloading "+(e+1)+"/"+n.length+" documents. Please wait...",i.offline_compatible?this.documentService.getDocument(i.id,this.documentsLastSynced).then((function(l){e+=1,l&&l.file_blob?t.offlineService.saveDocument(l).then((function(){t.downloadDocument(n,e)})).catch((function(){t.downloadDocument(n,e)})):t.downloadDocument(n,e)})).catch((function(){t.downloadDocument(n,e+=1)})):this.downloadDocument(n,e+=1)},n.prototype.getForms=function(){var n=this;this.formService.getFormGroups().then((function(e){n.offlineService.saveFormGroups(e),n.formService.getForms("",{orderby:"created_at",order:"asc",city:"",suburb:""}).then((function(e){n.offlineService.saveForms(e.data),n.showSuccess("forms"),n.offlineService.submissionsUploaded()})).catch((function(){n.showError("forms")}))})).catch((function(){n.showError("forms")}))},n.prototype.syncData=function(){var n=this;this.loadingController.create({message:"Your submissions are being synced. Please wait...",duration:2e4}).then((function(e){n.loading=e,e.present()})),this.offlineService.uploadingSubmissions?this.showSuccess("submissions"):(this.offlineService.getSubmissions().then((function(e){if(e){for(var t=0,l=e;t<l.length;t++){var o=l[t];n.submissionService.createSubmission(o.fields,o.form_id).then((function(){}))}n.submissionService.getSubmissions("").then((function(){n.showSuccess("submissions"),setTimeout((function(){n.offlineService.saveSubmissions([]).then((function(){n.offlineService.submissionsUploaded()}))}),5e3)})).catch((function(){n.showError("submissions")}))}else n.showSuccess("submissions")})).catch((function(){n.showError("submissions")})),this.offlineService.getUpdateSubmissions().then((function(e){if(e){for(var t=0,l=e;t<l.length;t++){var o=l[t];n.submissionService.updateSubmission(o.id,o.fields).then((function(){}))}n.submissionService.getSubmissions("").then((function(){setTimeout((function(){n.offlineService.saveUpdateSubmissions([]).then((function(){n.offlineService.submissionsUploaded()}))}),5e3)}))}})))},n.prototype.showSuccess=function(n){var e=this;setTimeout((function(){e.loading.dismiss(),e.alertCtrl.create({header:"Success",message:"Your "+n+" have been synced",buttons:[{text:"Dismiss",role:"cancel",handler:function(n){}}]}).then((function(n){n.present()}))}),1e3)},n.prototype.showError=function(n){var e=this;setTimeout((function(){e.loading.dismiss(),e.alertCtrl.create({header:"Error",message:"There was an error syncing your "+n+". Please try again.",buttons:[{text:"Dismiss",role:"cancel",handler:function(n){}}]}).then((function(n){n.present()}))}),1e3)},n.prototype.openChangePassword=function(){var n=this;this.alertCtrl.create({header:"Change Password",inputs:[{name:"password",placeholder:"Password",type:"password"},{name:"confirmPassword",placeholder:"Confirm Password",type:"password"}],buttons:[{text:"Cancel",role:"cancel",handler:function(n){}},{text:"Change",handler:function(e){e.password&&e.confirmPassword&&e.password===e.confirmPassword?n.authenticationService.changePassword(n.user.email,e.password,e.confirmPassword).then((function(){n.alertCtrl.create({header:"Success",message:"Your password has been updated",buttons:[{text:"Dismiss",role:"cancel",handler:function(n){}}]}).then((function(n){n.present()}))})).catch((function(){n.alertCtrl.create({header:"Error",message:"There was an error while changing your password.",buttons:[{text:"Cancel",role:"cancel",handler:function(n){}},{text:"Try Again",handler:function(e){setTimeout((function(){n.openChangePassword()}),200)}}]}).then((function(n){n.present()}))})):n.alertCtrl.create({header:"Error",message:"Passwords do not match",buttons:[{text:"Cancel",role:"cancel",handler:function(n){}},{text:"Try Again",handler:function(e){setTimeout((function(){n.openChangePassword()}),200)}}]}).then((function(n){n.present()}))}}]}).then((function(n){n.present()}))},n.prototype.formatDate=function(n){return f(n).format("DD/MM/YYYY")},n.prototype.logout=function(){this.authenticationService.logout()},n}(),g=function(){return function(){}}(),h=t("pMnS"),p=t("oBZk"),C=t("Ip0R"),b=l["\u0275crt"]({encapsulation:0,styles:[[".settings-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]{margin-bottom:10px;margin-top:20px;padding-top:10px}.settings-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]:first-child{margin-top:0;padding-top:0}.settings-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:0}.settings-list[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-left:5px}.settings-list[_ngcontent-%COMP%]   ion-icon[name=trophy][_ngcontent-%COMP%]{color:#ffbf00}.settings-list[_ngcontent-%COMP%]   ion-icon[name=heart][_ngcontent-%COMP%]{color:#e31b23}.settings-list[_ngcontent-%COMP%]   ion-icon[name=logo-facebook][_ngcontent-%COMP%]{color:#1778f2}.settings-list[_ngcontent-%COMP%]   ion-icon[name=logo-twitter][_ngcontent-%COMP%]{color:#1da1f2}.settings-list[_ngcontent-%COMP%]   ion-icon[name=mail][_ngcontent-%COMP%]{color:grey}.settings-list[_ngcontent-%COMP%]   ion-icon[name=unlock][_ngcontent-%COMP%]{color:#d6a000}.settings-list[_ngcontent-%COMP%]   ion-icon[name=lock][_ngcontent-%COMP%]{color:#d47835}.settings-list[_ngcontent-%COMP%]   ion-icon[name=cloud-upload][_ngcontent-%COMP%]{color:#8cd0ef}.settings-list[_ngcontent-%COMP%]   ion-icon[name=locate][_ngcontent-%COMP%]{color:#90e483}.settings-list[_ngcontent-%COMP%]   ion-icon[name=eye][_ngcontent-%COMP%]{color:#222428}"]],data:{}});function v(n){return l["\u0275vid"](0,[(n()(),l["\u0275eld"](0,0,null,null,3,"p",[],null,null,null,null,null)),(n()(),l["\u0275ted"](1,null,["Checkpoint "," "])),(n()(),l["\u0275eld"](2,0,null,null,1,"a",[],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.clearLastSynced(t)&&l),l}),null,null)),(n()(),l["\u0275ted"](-1,null,["Clear"]))],null,(function(n,e){var t=e.component;n(e,1,0,t.formatDate(t.documentsLastSynced))}))}function S(n){return l["\u0275vid"](0,[(n()(),l["\u0275eld"](0,0,null,null,11,"ion-header",[],null,null,null,p.P,p.k)),l["\u0275did"](1,49152,null,0,o.B,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["\u0275eld"](2,0,null,0,9,"ion-toolbar",[["color","primary"]],null,null,null,p.jb,p.E)),l["\u0275did"](3,49152,null,0,o.Cb,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{color:[0,"color"]},null),(n()(),l["\u0275eld"](4,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,p.K,p.f)),l["\u0275did"](5,49152,null,0,o.l,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["\u0275eld"](6,0,null,0,2,"ion-back-button",[["defaultHref","/login"]],null,[[null,"click"]],(function(n,e,t){var o=!0;return"click"===e&&(o=!1!==l["\u0275nov"](n,8).onClick(t)&&o),o}),p.H,p.c)),l["\u0275did"](7,49152,null,0,o.g,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{defaultHref:[0,"defaultHref"]},null),l["\u0275did"](8,16384,null,0,o.h,[[2,o.ib],o.Ib],{defaultHref:[0,"defaultHref"]},null),(n()(),l["\u0275eld"](9,0,null,0,2,"ion-title",[],null,null,null,p.ib,p.D)),l["\u0275did"](10,49152,null,0,o.Ab,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["\u0275ted"](-1,0,["Settings"])),(n()(),l["\u0275eld"](12,0,null,null,39,"ion-content",[],null,null,null,p.M,p.h)),l["\u0275did"](13,49152,null,0,o.u,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["\u0275eld"](14,0,null,0,37,"ion-list",[["class","settings-list"]],null,null,null,p.V,p.p)),l["\u0275did"](15,49152,null,0,o.O,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["\u0275eld"](16,0,null,0,6,"ion-item",[["detail",""]],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.syncData()&&l),l}),p.S,p.n)),l["\u0275did"](17,49152,null,0,o.H,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{detail:[0,"detail"]},null),(n()(),l["\u0275eld"](18,0,null,0,1,"ion-icon",[["name","refresh"],["slot","start"]],null,null,null,p.Q,p.l)),l["\u0275did"](19,49152,null,0,o.C,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{name:[0,"name"]},null),(n()(),l["\u0275eld"](20,0,null,0,2,"ion-label",[],null,null,null,p.T,p.o)),l["\u0275did"](21,49152,null,0,o.N,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["\u0275ted"](-1,0,["Sync Submissions"])),(n()(),l["\u0275eld"](23,0,null,0,6,"ion-item",[["detail",""]],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.syncForms()&&l),l}),p.S,p.n)),l["\u0275did"](24,49152,null,0,o.H,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{detail:[0,"detail"]},null),(n()(),l["\u0275eld"](25,0,null,0,1,"ion-icon",[["name","refresh"],["slot","start"]],null,null,null,p.Q,p.l)),l["\u0275did"](26,49152,null,0,o.C,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{name:[0,"name"]},null),(n()(),l["\u0275eld"](27,0,null,0,2,"ion-label",[],null,null,null,p.T,p.o)),l["\u0275did"](28,49152,null,0,o.N,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["\u0275ted"](-1,0,["Sync Forms"])),(n()(),l["\u0275eld"](30,0,null,0,9,"ion-item",[["detail",""]],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.syncDocuments()&&l),l}),p.S,p.n)),l["\u0275did"](31,49152,null,0,o.H,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{detail:[0,"detail"]},null),(n()(),l["\u0275eld"](32,0,null,0,1,"ion-icon",[["name","refresh"],["slot","start"]],null,null,null,p.Q,p.l)),l["\u0275did"](33,49152,null,0,o.C,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{name:[0,"name"]},null),(n()(),l["\u0275eld"](34,0,null,0,5,"ion-label",[],null,null,null,p.T,p.o)),l["\u0275did"](35,49152,null,0,o.N,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["\u0275eld"](36,0,null,0,1,"h2",[],null,null,null,null,null)),(n()(),l["\u0275ted"](-1,null,["Sync Documents"])),(n()(),l["\u0275and"](16777216,null,0,1,null,v)),l["\u0275did"](39,16384,null,0,C.j,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),l["\u0275eld"](40,0,null,0,6,"ion-item",[["detail",""]],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.openChangePassword()&&l),l}),p.S,p.n)),l["\u0275did"](41,49152,null,0,o.H,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{detail:[0,"detail"]},null),(n()(),l["\u0275eld"](42,0,null,0,1,"ion-icon",[["name","unlock"],["slot","start"]],null,null,null,p.Q,p.l)),l["\u0275did"](43,49152,null,0,o.C,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{name:[0,"name"]},null),(n()(),l["\u0275eld"](44,0,null,0,2,"ion-label",[],null,null,null,p.T,p.o)),l["\u0275did"](45,49152,null,0,o.N,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["\u0275ted"](-1,0,["Change Password"])),(n()(),l["\u0275eld"](47,0,null,0,4,"ion-item",[],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.logout()&&l),l}),p.S,p.n)),l["\u0275did"](48,49152,null,0,o.H,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["\u0275eld"](49,0,null,0,1,"ion-icon",[["name","lock"],["slot","start"]],null,null,null,p.Q,p.l)),l["\u0275did"](50,49152,null,0,o.C,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{name:[0,"name"]},null),(n()(),l["\u0275ted"](-1,0,[" Logout "]))],(function(n,e){var t=e.component;n(e,3,0,"primary"),n(e,7,0,"/login"),n(e,8,0,"/login"),n(e,17,0,""),n(e,19,0,"refresh"),n(e,24,0,""),n(e,26,0,"refresh"),n(e,31,0,""),n(e,33,0,"refresh"),n(e,39,0,t.documentsLastSynced),n(e,41,0,""),n(e,43,0,"unlock"),n(e,50,0,"lock")}),null)}function y(n){return l["\u0275vid"](0,[(n()(),l["\u0275eld"](0,0,null,null,1,"app-settings",[],null,null,null,S,b)),l["\u0275did"](1,114688,null,0,m,[o.Lb,c.a,i.a,o.a,s.a,u.a,r.a,o.Gb,a.a,d.a],null,null)],(function(n,e){n(e,1,0)}),null)}var D=l["\u0275ccf"]("app-settings",m,y,{},{},[]),w=t("gIcY"),P=t("ZYCi");t.d(e,"SettingsPageModuleNgFactory",(function(){return R}));var R=l["\u0275cmf"](g,[],(function(n){return l["\u0275mod"]([l["\u0275mpd"](512,l.ComponentFactoryResolver,l["\u0275CodegenComponentFactoryResolver"],[[8,[h.a,D]],[3,l.ComponentFactoryResolver],l.NgModuleRef]),l["\u0275mpd"](4608,C.l,C.k,[l.LOCALE_ID,[2,C.w]]),l["\u0275mpd"](4608,w.j,w.j,[]),l["\u0275mpd"](4608,o.b,o.b,[l.NgZone,l.ApplicationRef]),l["\u0275mpd"](4608,o.Hb,o.Hb,[o.b,l.ComponentFactoryResolver,l.Injector]),l["\u0275mpd"](4608,o.Mb,o.Mb,[o.b,l.ComponentFactoryResolver,l.Injector]),l["\u0275mpd"](1073742336,C.b,C.b,[]),l["\u0275mpd"](1073742336,w.i,w.i,[]),l["\u0275mpd"](1073742336,w.b,w.b,[]),l["\u0275mpd"](1073742336,o.Eb,o.Eb,[]),l["\u0275mpd"](1073742336,P.p,P.p,[[2,P.u],[2,P.m]]),l["\u0275mpd"](1073742336,g,g,[]),l["\u0275mpd"](1024,P.k,(function(){return[[{path:"",component:m}]]}),[])])}))}}]);